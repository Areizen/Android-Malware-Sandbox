var md_id;
var input_value;

function hashHook(){
    var MessageDigest = Java.use("java.security.MessageDigest");

    MessageDigest.update.overload('[B').implementation = function(input){
        var result = this.update(input);
        md_id = this.hashCode(); // method from Object
        input_value = new Uint8Array(input);
        return result;
    }

    MessageDigest.digest.overload().implementation = function(){
        var result = this.digest();
        if (this.hashCode() == md_id){
            var hexInput = Buffer.from(input_value).toString('hex');
            var hexOutput = Buffer.from(new Uint8Array(result)).toString('hex');
            var obj = {"plugin": "hash", "algo" : this.getAlgorithm(), "input_value": hexInput, "output_value": hexOutput};
            send(JSON.stringify(obj));
            md_id = '';
            input_value = '';
        }
        return result;
    }
}

hashHook();